<!DOCTYPE html>
<html lang="en">
	<head>

		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>院系党务系统</title>

		<link rel="stylesheet" href="assets/css/elementui.css">
		<!-- 引入组件库 -->
		<script src="assets/js/vue.js"></script><!-- vue -->
		<script src="assets/js/elementui.js"></script>
		<script src="assets/js/axios.js"></script>

		<style>
			.el-table{
				margin-bottom: 20px;
				/*font-size: 14px !important;*/
			}
			.demo-dynamic{
				margin: 10px auto 0;
				width: 400px;
			}
			[v-cloak] {
				display: none;
			}
			.block{
				text-align: center;
			}
		</style>

	</head>

	<body>
	<div id="app" style="margin: 15px;" v-cloak>

					<el-breadcrumb separator="/" style="padding-left:10px;padding-bottom:10px;font-size:14px;">
						<el-breadcrumb-item><a href="#">首页</a></el-breadcrumb-item>
						<el-breadcrumb-item>成员管理</el-breadcrumb-item>
						<el-breadcrumb-item>预备党员管理</el-breadcrumb-item>
					</el-breadcrumb>

					<el-card>
						<!-- 搜索与添加区域 -->
						<el-form :inline="true" ref="searchMap" :model="searchMap" size="mini" label-width="70px">
							<el-form-item label="姓名" >
								<el-input
										v-model="searchMap.name"
										placeholder="请输入姓名查询"
								></el-input>
							</el-form-item>
							<el-form-item>
								<el-select v-model="searchMap.generalId" clearable placeholder="党总支" @change="generalChanged">
									<el-option
											v-for="item in general"
											:key="item.id"
											:label="item.generalName"
											:value="item.id">
									</el-option>
								</el-select>
							</el-form-item>
							<el-form-item>
								<el-select v-model="searchMap.partyId" clearable placeholder="党支部" @change="partyChanged">
									<el-option
											v-for="item in party"
											:key="item.id"
											:label="item.partyName"
											:value="item.id">
									</el-option>
								</el-select>
							</el-form-item>
							<el-form-item>
								<el-select v-model="searchMap.groupId" clearable placeholder="党小组">
									<el-option
											v-for="item in group"
											:key="item.id"
											:label="item.groupName"
											:value="item.id">
									</el-option>
								</el-select>
							</el-form-item>
							<el-form-item>
								<el-select v-model="searchMap.leagueBranchId" clearable placeholder="团支部">
									<el-option
											v-for="item in youthLeagueBranch"
											:key="item.id"
											:label="item.name"
											:value="item.id">
									</el-option>
								</el-select>
							</el-form-item>
							<el-form-item>
								<el-button  @click="reset('searchMap')" icon="el-icon-refresh">重置</el-button>
								<el-button type="primary" icon="el-icon-search" @click="search()">查询</el-button>
							</el-form-item>
						</el-form>
						<el-form :inline="true" size="mini" style="margin-left: 28px">
							<el-form-item>
								<el-button type="success" icon="el-icon-plus" @click="addDialogOpen">新增</el-button>
								<el-button type="warning" icon="el-icon-position" @click="showRelationshipDialog()">关系转移</el-button>
								<el-button type="warning" icon="el-icon-edit" @click="showContactsDialog(id)">变更培养人</el-button>
								<el-button type="danger"  icon="el-icon-upload2"  @click="downExcel" >导出</el-button>
							</el-form-item>
							<el-form-item>
								<el-upload
										ref="upload"
										:auto-upload="true"
										:on-success="fileUploadSuccess"
										:on-error="fileUploadError"
										:disabled="importBtnDisabled"
										:loading="loading"
										:limit="1"
										action="http://localhost:9101/excel/leadInPreMember.do"
										name="file"
										accept="application/vnd.ms-excel">
									<el-button slot="trigger" type="success" icon="el-icon-plus">导入</el-button>
								</el-upload>
							</el-form-item>
							<el-form-item>
								<el-button icon="el-icon-download" @click="downModel">点击下载模版</el-button>
								<el-button icon="el-icon-download">发展对象预审表</el-button>
							</el-form-item>
						</el-form>
						<!--显示主体------------------------------------------------------>
						<el-table
								ref="multipleTable"
								:data="preMemberList"
								tooltip-effect="dark"
								style="width: 100%"
								size="mini"
								border
								stripe
								highlight-current-row
								@selection-change="handleSelectionChange" fit>
							<el-table-column
									type="selection"
									width="55"
									align="center">
							</el-table-column>
							<el-table-column
									type="index"
									label="#"
									align="center">
							</el-table-column>
							<el-table-column label="基本信息" align="center">
								<el-table-column
										prop="name"
										label="姓名"
										width="80"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="sex"
										label="性别"
										width="80"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="idCard"
										label="身份证"
										width="150"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="nativePlace"
										label="籍贯"
										width="80"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="residence"
										label="户籍所在地"
										width="110"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="nation"
										label="民族"
										width="80"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="phone"
										label="电话"
										width="100"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="grade"
										label="年级"
										width="80"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="classNum"
										label="班级"
										width="80"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="sid"
										label="学号"
										width="120"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="room"
										label="宿舍"
										width="80"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="duty"
										label="职务"
										width="100"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="title"
										label="职称"
										width="100"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="aducation"
										label="学历"
										width="100"
										sortable
										align="center">
								</el-table-column>
							</el-table-column>
							<el-table-column label="党务信息" align="center">
								<el-table-column
										prop="generalName"
										label="所属党总支"
										width="120"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="partyName"
										label="所属党支部"
										width="120"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="groupName"
										label="所属党小组"
										width="120"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="leagueBranchName"
										label="所属团支部"
										width="120"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="petitionConfirm"
										label="申请书落款时间"
										width="150"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="activistTime"
										label="确定积极分子时间"
										width="150"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="developTime"
										label="确定发展对象时间"
										width="150"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="preMemberTime"
										label="确定预备党员时间"
										width="150"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="culture1Name"
										label="培养联系人1"
										width="120"
										sortable
										align="center">
								</el-table-column>
								<el-table-column
										prop="culture2Name"
										label="培养联系人2"
										width="120"
										sortable
										align="center">
								</el-table-column>
							</el-table-column>

							<el-table-column label="操作" width="200" fixed="right" align="center">
								<template slot-scope="scope">
									<!-- 编辑 -->
									<el-tooltip effect="dark" content="查看个人信息" placement="top" :enterable="false">
										<el-button type="primary" icon="el-icon-user" size="mini" @click="showUserDialog(scope.row.id)"></el-button>
									</el-tooltip>
									<!-- 查看其相关文档 -->
									<el-tooltip effect="dark" content="查看其相关文档" placement="top" :enterable="false">
										<el-button icon="el-icon-folder" size="mini" @click="showFileDialog"></el-button>
									</el-tooltip>
									<!-- 删除按钮 -->
									<el-tooltip effect="dark" content="删除信息" placement="top" :enterable="false">
										<el-button type="danger" icon="el-icon-delete" size="mini" @click="removeGroupById(scope.row.id)"></el-button>
									</el-tooltip>
								</template>
							</el-table-column>
						</el-table>

						<!-- 分页区域 页码大小  当前页  -->
						<el-pagination
								class="pagiantion"
								@size-change="handleSizeChange"
								@current-change="handleCurrentChange"
								:current-page.sync="currentPage"
								:page-sizes="[1, 2, 4, 8, 10]"
								:page-size="size"
								layout="total, sizes, prev, pager, next, jumper"
								:total="total">
						</el-pagination>
					</el-card>


		<!-- 查看上传文档情况的对话框 -->
					<el-dialog title="查看上传文档情况" :visible.sync="fileDialogVisible" width="50%">
						<el-timeline>
							<el-timeline-item
									v-for="file in files"
									:key="file.id"
									:timestamp="file.uploadTime"
									placement="top">
								<el-card>
									<el-link type="primary" @click="innerDialog(file)">{{ file.fileName }}</el-link>
									<el-tag type="danger" style="margin-left: 10px;cursor: pointer" @click="removeFile(file)">删除</el-tag>
									<p>{{ file.username }} 提交于 {{ file.uploadTime }}</p>
								</el-card>
							</el-timeline-item>
						</el-timeline>

						<el-dialog
								width="30%"
								:visible.sync="innerVisible"
								append-to-body>
							<div class="demo-image">
								<div class="block">
									<el-image
											style="width: 100px; height: 100px"
											:src="url"
											:preview-src-list="srcList">
									</el-image>
								</div>
							</div>

						</el-dialog>

						<!-- 底部区域 -->
						<span slot="footer" class="dialog-footer">
							<el-button @click="fileDialogVisible = false">取 消</el-button>
						</span>
					</el-dialog>

					<!-- 添加的对话框 -->
					<el-dialog  title="新增" :close-on-click-modal="false" :visible.sync="addDialogVisible" width="55%" @close="addDialogClosed">
						<!-- 内容主体区域 -->
						<el-form :rules="addFormRules" :model="addForm" ref="addFormRef" label-width="80px">
							<el-row>
								<el-col :span="8">
									<el-form-item label="姓名">
										<el-input v-model="addForm.name"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="性别" label-width="60px">
										<el-radio v-model="addForm.sex" label="男">男</el-radio>
										<el-radio v-model="addForm.sex" label="女">女</el-radio>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="民族">
										<el-input v-model="addForm.nation"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="12">
									<el-form-item label="籍贯">
										<el-input v-model="addForm.nativePlace"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="12">
									<el-form-item label="户籍所在地" label-width="100px">
										<el-input v-model="addForm.residence"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="24">
									<el-form-item label="身份证">
										<el-input v-model="addForm.idCard"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="8">
									<el-form-item label="联系电话" prop="phone">
										<el-input v-model="addForm.phone"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="年级">
										<el-input v-model="addForm.grade"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="班级">
										<el-input v-model="addForm.classNum"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="8">
									<el-form-item label="学号" prop="sid" >
										<el-input v-model="addForm.sid" ></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="宿舍" >
										<el-input v-model="addForm.room"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="团支部">
										<el-select
												clearable
												v-model="addForm.leagueBranchId"
												placeholder="请选择团支部">
											<el-option
													v-for="item in youthLeagueBranch"
													:key="item.id"
													:label="item.name"
													:value="item.id">
											</el-option>
										</el-select>
									</el-form-item>
								</el-col>

							</el-row>
							<el-row>
								<el-col :span="8">
									<el-form-item label="党总支">
										<!--v-model封装给addForm的哪个属性-->
										<el-select
												clearable
												v-model="addForm.generalId"
												placeholder="请选择党总支"
												@change="generalChanged"
										>
											<el-option
													v-for="item in general"
													:key="item.id"
													:label="item.generalName"
													:value="item.id">
											</el-option>
										</el-select>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="党支部">
										<!--v-model封装给addForm的哪个属性-->
										<el-select
												clearable
												v-model="addForm.partyId"
												placeholder="请选择党支部" @change="partyChanged">
											<el-option
													v-for="item in party"
													:key="item.id"
													:label="item.partyName"
													:value="item.id">
											</el-option>
										</el-select>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="党小组">
										<el-select
												clearable
												v-model="addForm.groupId"
												placeholder="请选择党小组">
											<el-option
													v-for="item in group"
													:key="item.id"
													:label="item.groupName"
													:value="item.id">
											</el-option>
										</el-select>
									</el-form-item>
								</el-col>


							</el-row>
							<el-row>
								<el-col :span="24">
									<el-form-item
											prop="culturel1Name"
											label="培养联系人1"
											label-width="120px">
										<el-cascader
												style="width:100%;"
												placeholder="请选择培养联系人"
												v-model="addForm.culture1Id"
												:options="contacts"
												clearable>

										</el-cascader>

									</el-form-item>
								</el-col>
							</el-row>

							<el-row>
								<el-col :span="24">
									<el-form-item
											prop="culturel2Name"
											label="培养联系人2"
											label-width="120px">
										<el-cascader
												style="width:100%;"
												placeholder="请选择培养联系人"
												v-model="addForm.culture2Id"
												:options="contacts"
												clearable></el-cascader>
									</el-form-item>
								</el-col>
							</el-row>

							<el-row>
								<el-col :span="8">
									<el-form-item label="职务">
										<el-input v-model="addForm.duty"></el-input>
									</el-form-item>
								</el-col>

								<el-col :span="8">
									<el-form-item label="职称">
										<el-input v-model="addForm.title"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="学历">
										<el-input v-model="addForm.aducation"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="12">
									<el-form-item label="申请书落款日期" label-width="125px">
										<el-date-picker type="date" placeholder="选择日期" v-model="addForm.petitionConfirm" style="width: 100%;"></el-date-picker>
									</el-form-item>
								</el-col>
								<el-col :span="12">
									<el-form-item label="确定积极分子日期" label-width="130px">
										<el-date-picker type="date" placeholder="选择日期" v-model="addForm.activistTime" style="width: 100%;"></el-date-picker>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>

								<el-col :span="12">
									<el-form-item label="确定发展对象日期" label-width="125px">
										<el-date-picker type="date" placeholder="选择日期" v-model="addForm.developTime" style="width: 100%;"></el-date-picker>
									</el-form-item>
								</el-col>
								<el-col :span="12">
									<el-form-item label="确定预备党员日期" label-width="130px">
										<el-date-picker type="date" placeholder="选择日期" v-model="addForm.preMemberTime" style="width: 100%;"></el-date-picker>
									</el-form-item>
								</el-col>
							</el-row>
							<el-form-item label="家庭地址(详细)"label-width="110px">
								<el-input v-model="addForm.address"></el-input>
							</el-form-item>
						</el-form>
						<!-- 底部区域 -->
						<span slot="footer" class="dialog-footer">
													<el-button @click="addDialogVisible = false">取 消</el-button>
													<el-button type="primary" @click="add">确 定</el-button>
												</span>
					</el-dialog>

					<el-dialog  title="修改" :close-on-click-modal="false" :visible.sync="updateDialogVisible" width="55%" @close="addDialogClosed">
						<!-- 内容主体区域 -->
						<el-form :rules="updateFormRules" :model="addForm" ref="addFormRef" label-width="80px">
							<el-row>
								<el-col :span="8">
									<el-form-item label="姓名">
										<el-input v-model="addForm.name"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="性别" label-width="60px">
										<el-radio v-model="addForm.sex" label="男">男</el-radio>
										<el-radio v-model="addForm.sex" label="女">女</el-radio>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="民族">
										<el-input v-model="addForm.nation"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="12">
									<el-form-item label="籍贯">
										<el-input v-model="addForm.nativePlace"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="12">
									<el-form-item label="户籍所在地" label-width="100px">
										<el-input v-model="addForm.residence"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="24">
									<el-form-item label="身份证">
										<el-input v-model="addForm.idCard"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="8">
									<el-form-item label="联系电话" prop="phone">
										<el-input v-model="addForm.phone"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="年级">
										<el-input v-model="addForm.grade"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="班级">
										<el-input v-model="addForm.classNum"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="8">
									<el-form-item label="学号" prop="sid" >
										<el-input v-model="addForm.sid" disabled></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="宿舍" >
										<el-input v-model="addForm.room"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="团支部">
										<el-select
												clearable
												v-model="addForm.leagueBranchId"
												placeholder="请选择团支部">
											<el-option
													v-for="item in youthLeagueBranch"
													:key="item.id"
													:label="item.name"
													:value="item.id">
											</el-option>
										</el-select>
									</el-form-item>
								</el-col>

							</el-row>
							<el-row>
								<el-col :span="8">
									<el-form-item label="党总支">
										<!--v-model封装给addForm的哪个属性-->
										<el-select
												clearable
												v-model="addForm.generalId"
												placeholder="请选择党总支"
												@change="generalChanged"
										>
											<el-option
													v-for="item in general"
													:key="item.id"
													:label="item.generalName"
													:value="item.id">
											</el-option>
										</el-select>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="党支部">
										<!--v-model封装给addForm的哪个属性-->
										<el-select
												clearable
												v-model="addForm.partyId"
												placeholder="请选择党支部" @change="partyChanged">
											<el-option
													v-for="item in party"
													:key="item.id"
													:label="item.partyName"
													:value="item.id">
											</el-option>
										</el-select>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="党小组">
										<el-select
												clearable
												v-model="addForm.groupId"
												placeholder="请选择党小组">
											<el-option
													v-for="item in group"
													:key="item.id"
													:label="item.groupName"
													:value="item.id">
											</el-option>
										</el-select>
									</el-form-item>
								</el-col>


							</el-row>
							<el-row>
								<el-col :span="24">
									<el-form-item
											prop="culturel1Name"
											label="培养联系人1"
											label-width="120px">
										<el-cascader
												style="width:100%;"
												placeholder="请选择培养联系人"
												v-model="addForm.culture1Id"
												:options="contacts"
												clearable>

										</el-cascader>

									</el-form-item>
								</el-col>
							</el-row>

							<el-row>
								<el-col :span="24">
									<el-form-item
											prop="culturel2Name"
											label="培养联系人2"
											label-width="120px">
										<el-cascader
												style="width:100%;"
												placeholder="请选择培养联系人"
												v-model="addForm.culture2Id"
												:options="contacts"
												clearable></el-cascader>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="8">
									<el-form-item label="职务">
										<el-input v-model="addForm.duty"></el-input>
									</el-form-item>
								</el-col>

								<el-col :span="8">
									<el-form-item label="职称">
										<el-input v-model="addForm.title"></el-input>
									</el-form-item>
								</el-col>
								<el-col :span="8">
									<el-form-item label="学历">
										<el-input v-model="addForm.aducation"></el-input>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>
								<el-col :span="12">
									<el-form-item label="申请书落款日期" label-width="125px">
										<el-date-picker type="date" placeholder="选择日期" v-model="addForm.petitionConfirm" style="width: 100%;"></el-date-picker>
									</el-form-item>
								</el-col>
								<el-col :span="12">
									<el-form-item label="确定积极分子日期" label-width="130px">
										<el-date-picker type="date" placeholder="选择日期" v-model="addForm.activistTime" style="width: 100%;"></el-date-picker>
									</el-form-item>
								</el-col>
							</el-row>
							<el-row>

								<el-col :span="12">
									<el-form-item label="确定发展对象日期" label-width="125px">
										<el-date-picker type="date" placeholder="选择日期" v-model="addForm.developTime" style="width: 100%;"></el-date-picker>
									</el-form-item>
								</el-col>
								<el-col :span="12">
									<el-form-item label="确定预备党员日期" label-width="130px">
										<el-date-picker type="date" placeholder="选择日期" v-model="addForm.preMemberTime" style="width: 100%;"></el-date-picker>
									</el-form-item>
								</el-col>
							</el-row>
							<el-form-item label="家庭地址(详细)"label-width="110px">
								<el-input v-model="addForm.address"></el-input>
							</el-form-item>
						</el-form>
						<!-- 底部区域 -->
						<span slot="footer" class="dialog-footer">
																<el-button @click="updateDialogVisible = false">取 消</el-button>
																<el-button type="primary" @click="add">确 定</el-button>
															</span>
					</el-dialog>

		<!-- 查看信息的对话框 -->
		<!--
					<el-dialog title="预备党员表" :visible.sync="showDialogVisible" width="50%" @close="showDialogClosed">
						<table align="center" style="text-align: center" border="2px" width="500px" height="700px" cellspacing="0" cellpadding="2">
							<tr>
								<td align="center" colspan="7">一、基本信息</td>
							</tr>
							<tr>
								<td>姓名</td>
								<td width="15%">{{ preMemberList[0].name }}</td>
								<td>性别</td>
								<td width="15%">{{ preMemberList[0].sex }}</td>
								<td>民族</td>
								<td width="15%">{{ preMemberList[0].nation }}</td>
								<td  width="18%" rowspan="2" align="center">照片</td>
							</tr>
							<tr>
								<td >籍贯</td>
								<td >{{ preMemberList[0].nativePlace }}</td>
								<td >出生日期</td>
								<td colspan="3">{{ preMemberList[0].birth }}</td>
							</tr>
							<tr>
								<td >身份证号码</td>
								<td colspan="6">{{ preMemberList[0].idCard }}</td>
							</tr>
							<tr>
								<td>职务/职称</td>
								<td >{{ preMemberList[0].duty }}</td>
								<td colspan="2">申请入党时间</td>
								<td colspan="3">{{ preMemberList[0].applyTime }}</td>
							</tr>
							<tr>
								<td>学历</td>
								<td >{{ preMemberList[0].education }}</td>
								<td colspan="2">所属党小组</td>
								<td colspan="3">{{ preMemberList[0].group }}</td>
							</tr>
							<tr>
								<td>培养联系人1</td>
								<td >{{ preMemberList[0].culturel1Name }}</td>
								<td colspan="2">培养联系人2</td>
								<td colspan="3">{{ preMemberList[0].culturel2Name }}</td>
							</tr>
							<tr>
								<td>联系电话</td>
								<td >{{ preMemberList[0].phoneNum }}</td>
								<td colspan="2">电子邮箱</td>
								<td colspan="3">{{ preMemberList[0].email }}</td>
							</tr>
							<tr>
								<td>家庭地址(详细)</td>
								<td colspan="6">{{ preMemberList[0].address }}</td>
							</tr>

						</table>
						<span slot="footer" class="dialog-footer">

        					<el-button @click="showDialogVisible = false">取 消</el-button>
        					<el-button type="primary">确 定</el-button>
      					</span>
					</el-dialog>
-->
					<!-- 关系转移的对话框 -->
					<el-dialog title="关系转移" :visible.sync="relationshipDialogVisible" width="40%" @close="setRelationshipDialogClosed">
						<el-card>
							<el-alert
									title="注：该模块可直接由上级管理员批量操作，不需要个人申请"
									type="warning"
									show-icon
									center>
							</el-alert>
							<el-form label-position="right" label-width="80px" :model="formLabelAlign" style="margin-top: 20px">
								<el-form-item label="已选择">
									<el-col :span="8">
										<el-input v-model="formLabelAlign.sum" disabled></el-input>
									</el-col>

								</el-form-item>
								<el-form-item label="申请转入">
									<el-cascader :options="options" v-model="formLabelAlign.organization" clearable></el-cascader>
								</el-form-item>
							</el-form>
						</el-card>

						<span slot="footer" class="dialog-footer">
													<el-button @click="relationshipDialogVisible = false">取 消</el-button>
													<el-button type="primary" @click="transfer">确 定</el-button>
												</span>
					</el-dialog>

					<!-- 变更培养联系人的对话框 -->
					<el-dialog title="变更培养联系人" :visible.sync="contactsDialogVisible" width="50%" @close="setContactsDialogClosed">
						<el-card>
							<el-alert
									title="注：每名成员都会有至少1名正式党员担任介绍人或培养人"
									type="warning"
									show-icon
									center>
							</el-alert>
							<el-form :model="dynamicValidateForm" label-position="right" ref="dynamicValidateForm" class="demo-dynamic">
								<el-form-item
										prop="sum"
										label="已选择">
									<el-input v-model="dynamicValidateForm.sum" disabled></el-input>
								</el-form-item>
								<el-form-item
										prop="culturel1Name"
										label="培养联系人1">
									<el-cascader
											placeholder="请选择培养联系人"
											:options="contacts"
											v-model="dynamicValidateForm.organization1"
											:show-all-levels="false"
											filterable
											clearable>
									</el-cascader>
								</el-form-item>
								<el-form-item
										prop="culturel2Name"
										label="培养联系人2">
									<el-cascader
											placeholder="请选择培养联系人"
											:options="contacts"
											v-model="dynamicValidateForm.organization2"
											:show-all-levels="false"
											filterable
											clearable>
									</el-cascader>
								</el-form-item>
							</el-form>
						</el-card>

						<span slot="footer" class="dialog-footer">
								<el-button @click="contactsDialogVisible = false">取 消</el-button>
							<el-button type="primary" @click="change_cul">确 定</el-button>
						</span>
					</el-dialog>

	</div>

		<script>
			new Vue({
				el: '#app',
				// router,
				data() {
					// 验证手机号的规则
					var checkMobile = (rule, value, cb) => {
						// 验证手机号的正则表达式
						const regMobile = /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/

						if (regMobile.test(value)) {
							return cb()
						}

						cb(new Error('请输入合法的手机号'))
					}
					var checkSid=(rule, value, cb)=>{
						// 验证手机号的正则表达式
						const regSid = /\b\d{12}\b/

						if (regSid.test(value)) {
							axios.get(`/baseUser/uniqueSid.do?sid=${this.addForm.sid}`).then(response => {
								if (response.data.data.items==1){
									cb(new Error('当前学号已被用'))
								}else {
									return cb()
								}

							});
						}else {
							cb(new Error('请输入合法的学号'))
						}
					}
					return {
						searchMap:{
							name:'',
							generalId:'',
							partyId:'',
							groupId:'',
							leagueBranchId:''
						},
						general:[],
						party:[],
						youthLeagueBranch: [],
						group: [],
						preMemberList: [],
						//检索党支部
						selectParty: [],
						//检索党小组
						selectGroup: [],
						//检索团支部
						selectYouth: [],
						//全选
						multipleSelection: [],
						//当前页
						currentPage: 1,
						//总数
						total: 10,
						size: 10,
						// 控制添加对话框的显示与隐藏
						addDialogVisible: false,
						updateDialogVisible: false,
						// 添加的表单数据
						addForm: {
						},
						// 添加表单的验证规则对象
						addFormRules: {
							phone: [
								{ required: true, message: '请输入手机号', trigger: 'blur' },
								{ validator: checkMobile, trigger: 'blur' }
							],
							sid:[
								{ required: true, message: '请输入学号', trigger: 'blur' },
								{ validator: checkSid, trigger: 'blur' }
							]

						},
						updateFormRules: {
							phone: [
								{ required: true, message: '请输入手机号', trigger: 'blur' },
								{ validator: checkMobile, trigger: 'blur' }
							],
						},
						// 控制查看信息对话框的显示与隐藏
						showDialogVisible: false,
						// 控制查看文档对话框的显示与隐藏
						fileDialogVisible: false,
						//文件对象
						files: {
							id: '',
							fileName: '',
							uploadTime: '',
							filePath: '',
							username: ''
						},

						// 控制查看文档对话框里面的对话框的显示与隐藏
						innerVisible: false,
						url: '',
						srcList: [],
						// 控制关系转移对话框的显示与隐藏
						relationshipDialogVisible: false,
						formLabelAlign: {
						},
						//关系转移的级联选择器
						options: [],
						// 控制变更培养联系人对话框的显示与隐藏
						contactsDialogVisible: false,
						//可选择培养联系人列表
						contacts: [],
						importBtnDisabled: false, // 按钮是否禁用,
						loading: false,
						dynamicValidateForm: {
							organization1:[],
							organization2:[]
						}
					}
				},
				created() {
					this.getPreMemberList()
					this.getGeneralList()
					this.getYouthLeagueBranchList()
				},
				methods: {
					fileUploadSuccess(response){
						//提示信息
						this.loading = false
						this.$message.success("导入成功");
						this.getPreMemberList()
					},
					fileUploadError() {
						this.loading = false
						this.$message.error("导入失败");
					},
					handleSizeChange(val) {
						this.currentPage=1;
						this.size=val;
						this.getPreMemberList();
					},
					handleCurrentChange(val) {
						this.currentPage=val;
						this.getPreMemberList();
					},
					search(){
						this.currentPage=1,
								this.getPreMemberList()

					},
					getPreMemberList() {
						//向后台获取数据列表
						axios.post(`/baseUser/findCommonPage.do?page=${this.currentPage}&size=${this.size}&type=2`,this.searchMap).then(response => {
							this.preMemberList = response.data.data.pageInfo.rows;
							this.total = response.data.data.pageInfo.total;
						});
					},
					getYouthLeagueBranchList(){
						axios.get(`/leagueBranch/findAll.do`).then(response => {
							this.youthLeagueBranch = response.data.data.items;
						});
					},
					getGeneralList(){
						axios.get(`/general/findAll.do`).then(response => {
							this.general = response.data.data.items;
						});
					},
					generalChanged(value){//点击党总支触发chage，显示对应的支部
						this.generalId=value;
						//查找这个党总支下面的所有党支部
						axios.get(`/party/findByGeneralId.do?generalId=${this.generalId}`).then(response => {
							this.party = response.data.data.items;
						});
					},
					partyChanged(value){
						this.partyId=value;
						axios.get(`/group/findByPartyId.do?partyId=${this.partyId}`).then(response => {
							this.group = response.data.data.items;
						});
					},
					downModel(){
						window.location.href="model/preMember.xlsx";
					},
					downExcel(){
						window.location.href="/excel/leadOutPreMember.do";
					},
					filterCell(value, row) {
						return row.party === value;
					},
					filterCell2(value, row) {
						return row.group === value;
					},
					filterCell3(value, row) {
						return row.youthLeagueBranch === value;
					},
					//获取培养联系人级联下拉列表
					getAllOption(){
						axios.get(`/option/getOption.do`).then(response => {
							this.contacts = response.data.data.items;
						});

					},
					/**
					 * 重置
					 */
					reset(){
						this.searchMap={
							name:'',
							generalId:'',
							partyId:'',
							groupId:'',
							leagueBranchId:''
						}
						this.getPreMemberList()
					},
					toggleSelection(rows) {
						if (rows) {
							rows.forEach(row => {
								this.$refs.multipleTable.toggleRowSelection(row);
							});
						} else {
							this.$refs.multipleTable.clearSelection();
						}
					},
					handleSelectionChange(val) {
						this.multipleSelection = val;
						var array=[];
						val.forEach((val,index)=>{
							array.push(val.id);
						})
						this.formLabelAlign.select=array;//选中的人的id
						this.dynamicValidateForm.select=array;
					},
					addDialogOpen() {
						this.addForm={}
						this.getAllOption()//获取培养联系人级联下拉列表
						this.addDialogVisible = true
					},
					// 点击按钮单个导入成员
					add() {
						this.$refs.addFormRef.validate(async valid => {
							if (!valid) return
							// 可以发起添加成员的网络请求
							axios.post(`/baseUser/${this.addForm.id==null?'add':'updateCommon'}.do?type=2`,this.addForm).then(response => {
								if (this.addForm.id==null){
									this.$message.success('添加成员成功！')
									// 隐藏添加成员的对话框
									this.addDialogVisible = false
								}else {
									this.$message.success('修改成员成功！')
									this.updateDialogVisible = false
								}
								// 重新获取成员列表数据
								this.getPreMemberList()
							});

						})
					},
					// 监听添加成员对话框的关闭事件
					addDialogClosed() {
						this.$refs.addFormRef.resetFields()
					},
					// 监听查看信息对话框的关闭事件
					showDialogClosed() {
						//this.$refs.addFormRef.resetFields()
					},
					// 展示信息的对话框
					showUserDialog(id) {
						//根据id
						this.updateDialogVisible = true
						this.getAllOption()
						axios.get(`/baseUser/findCommonById.do?id=${id}&type=2`).then(response => {
							this.addForm = response.data.data.items;

						});
					},
					// 根据Id删除对应的预备党员信息
					async removeGroupById(id) {
						// 弹框询问党小组是否删除数据
						this.$confirm('确定要删除此记录吗?', '提示', {
							confirmButtonText: '确定',
							cancelButtonText: '取消',
							type: 'warning'
						}).then( () => {
							axios.get(`/baseUser/delete.do?id=${id}`).then(response => {
								this.$message.success('删除预备党员成功！')
								this.getPreMemberList()
							})
						})

					},
					showFileDialog() {
						//此处应向后台获取数据
						this.files = [
							{
								id: '1',
								fileName: '入党申请书',
								uploadTime: '2020/10/13 20:00:00',
								filePath: [
									'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg',
									'https://fuss10.elemecdn.com/8/27/f01c15bb73e1ef3793e64e6b7bbccjpeg.jpeg',
									'https://fuss10.elemecdn.com/1/8e/aeffeb4de74e2fde4bd74fc7b4486jpeg.jpeg'
								],
								username: '赖乐宗'
							},{
								id: '2',
								fileName: '入党申请书',
								uploadTime: '2020/10/13 20:00:00',
								filePath: [
									'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg',
									'https://fuss10.elemecdn.com/8/27/f01c15bb73e1ef3793e64e6b7bbccjpeg.jpeg',
									'https://fuss10.elemecdn.com/1/8e/aeffeb4de74e2fde4bd74fc7b4486jpeg.jpeg'
								],
								username: '赖乐宗'
							},{
								id: '3',
								fileName: '入党申请书',
								uploadTime: '2020/10/13 20:00:00',
								filePath: [
									'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg',
									'https://fuss10.elemecdn.com/8/27/f01c15bb73e1ef3793e64e6b7bbccjpeg.jpeg',
									'https://fuss10.elemecdn.com/1/8e/aeffeb4de74e2fde4bd74fc7b4486jpeg.jpeg'
								],
								username: '赖乐宗'
							}
						]
						this.fileDialogVisible = true
					},
					innerDialog(file) {
						//此处应向后台获取数据
						this.url = file.filePath[0]
						this.srcList = file.filePath
						this.innerVisible = true
					},
					//删除文件
					async removeFile(file) {
						// 弹框询问是否删除数据
						const confirmResult = await this.$confirm(
								'此操作将永久删除该文件, 是否继续?',
								'提示',
								{
									confirmButtonText: '确定',
									cancelButtonText: '取消',
									type: 'warning'
								}
						).catch(err => err)

						// 如果确认删除，则返回值为字符串 confirm
						// 如果取消了删除，则返回值为字符串 cancel
						// console.log(confirmResult)
						if (confirmResult !== 'confirm') {
							return this.$message.info('已取消删除')
						}
						//此处向后台发请求进行删除
						this.$message.success('删除文件成功！')
						this.fileDialogVisible = false
					},
					showRelationshipDialog() {
						if(this.multipleSelection.length==0){//选择了多少项
							this.$message.error('请选择你想转移的成员')
							return
						}
						//先统计多选框里选中的人数。得出sum
						this.formLabelAlign.sum = this.multipleSelection.length
						//此处应向后台获取options数据
						axios.get(`/option/getTransferOption.do`).then(response =>{
							this.options = response.data.data.items
						})
						this.relationshipDialogVisible  = true
					},
					//处理关系转移的方法
					transfer(){
						// alert(JSON.stringify(this.formLabelAlign))
						//要传选中的人的id过去，还要传选中的党小组id
						axios.post(`/baseUser/transfer.do`,this.formLabelAlign).then(response => {
							this.$message.success('关系转移成功！')
							this.getPreMemberList()
							this.relationshipDialogVisible = false
						})
					},
					// 监听分配权限对话框的关闭事件
					setRelationshipDialogClosed() {
						this.formLabelAlign = {
							sum: ''
						}
					},
					//变更培养联系人
					showContactsDialog(id) {
						if(this.multipleSelection.length == 0){
							this.$message.error('请选择你想变更联系人的成员')
							return
						}
						//先统计多选框里选中的人数。得出sum
						this.dynamicValidateForm.sum = this.multipleSelection.length
						//获取培养联系人列表
						this.getAllOption()
						this.contactsDialogVisible  = true
					},
					// 监听变更培养联系人对话框的关闭事件
					setContactsDialogClosed() {
						this.dynamicValidateForm = {
							organization1:[],
							organization2:[]
						}
					},
					change_cul(){
						axios.post(`/baseUser/changeCul.do`,this.dynamicValidateForm).then(response => {
							this.$message.success('变更培养联系人成功！')
							this.getPreMemberList()
							this.contactsDialogVisible = false
						})
					},
					submitForm(formName) {
						this.$refs[formName].validate((valid) => {
							if (valid) {
								alert('提交!');
							} else {
								console.log('error submit!!');
								return false;
							}
						});
					},
					resetForm(formName) {
						this.$refs[formName].resetFields();
					},
					removeDomain(item) {
						var index = this.dynamicValidateForm.contacts.indexOf(item)
						if (index !== -1) {
							this.dynamicValidateForm.contacts.splice(index, 1)
						}
					},
					addDomain() {
						this.dynamicValidateForm.contacts.push({
							value: '',
							key: Date.now()
						});
					}
				}
			})
		</script>
	</body>
</html>